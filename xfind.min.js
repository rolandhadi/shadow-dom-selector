/**
 * @description Locates the first matching elements on the page, even within shadow DOMs, using a complex n-depth selector.
 * Author: Roland Ross L. Hadi
 * GitHub: https://github.com/rolandhadi/shadow-dom-selector
 */
function xfind(e,t=document){validateSelector(e);const o=e.split(">>>");let r=t;for(const e of o)if(r=querySelectorXFind(e,r),null===r)return console.error(`Selector ${e} not found`),null;return r}function xfindAll(e,t=document){validateSelector(e);const o=e.split(">>>");let r=t;for(let e=0;e<o.length-1;e++)if(r=querySelectorXFind(o[e],r),null===r)return console.error(`Selector ${o[e]} not found`),[];return querySelectorAllXFind(o[o.length-1],r)}function querySelectorAllXFind(e,t=document){return validateSelector(e),performQuery(e,!0,t)}function querySelectorXFind(e,t=document){return validateSelector(e),performQuery(e,!1,t)}function performQuery(e,t,o){let r=o.querySelector(e);if(document.head.createShadowRoot||document.head.attachShadow){if(!t&&r)return r;return splitByUnquotedCharacter(e,",").reduce(((e,r)=>{if(!t&&e)return e;const n=splitByUnquotedCharacter(r.trim().replace(/\s*([>+~])\s*/g,"$1")," ").filter(Boolean),l=n.length-1,c=gatherAllElementsXFind(n[l],o),u=matchElements(n,l,o);return t?e.concat(c.filter(u)):c.find(u)||null}),t?[]:null)}return t?o.querySelectorAll(e):r}function matchElements(e,t,o){return r=>{let n=t,l=r;for(;l;){const t=!!l.matches&&l.matches(e[n]);if(t&&0===n)return!0;t&&n--,l=getParentOrHost(l,o)}return!1}}function splitByUnquotedCharacter(e,t){return e.match(/\\?.|^$/g).reduce(((e,o)=>('"'!==o||e.singleQuote?"'"!==o||e.doubleQuote?e.doubleQuote||e.singleQuote||o!==t?e.strings[e.strings.length-1]+=o:e.strings.push(""):(e.singleQuote^=1,e.strings[e.strings.length-1]+=o):(e.doubleQuote^=1,e.strings[e.strings.length-1]+=o),e)),{strings:[""],doubleQuote:0,singleQuote:0}).strings}function getParentOrHost(e,t){const o=e.parentNode;return o&&o.host&&11===o.nodeType?o.host:o===t?null:o}function gatherAllElementsXFind(e=null,t){const o=[],r=e=>{for(const t of e)o.push(t),t.shadowRoot&&r(t.shadowRoot.querySelectorAll("*"))};return t.shadowRoot&&r(t.shadowRoot.querySelectorAll("*")),r(t.querySelectorAll("*")),e?o.filter((t=>t.matches(e))):o}function validateSelector(e){try{document.createElement("div").querySelector(e)}catch{throw new Error(`Invalid selector: ${e}`)}}function highlightElements(e){const t=e=>{const t=e.style.outline;e.style.outline="2px solid red",setTimeout((()=>{e.style.outline=t}),2e3)};Array.isArray(e)?e.forEach(t):e&&t(e)}function showWelcomeMessage(){console.log("%cWelcome to Shadow DOM Selector!","color: green; font-size: 16px;"),console.log("%cAuthor: Roland Ross L. Hadi","color: blue; font-size: 14px;"),console.log("%cGitHub: https://github.com/rolandhadi/shadow-dom-selector","color: blue; font-size: 14px;"),console.log("%cExample usage: xfind('downloads-item:nth-child(4) #remove');","color: orange; font-size: 14px;")}showWelcomeMessage();
